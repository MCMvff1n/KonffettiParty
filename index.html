<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tile Connect</title>

<style>
:root {
  --tile-size: 42px;
  --gap: 6px;
}

body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: hidden;
}

#hud {
  display: flex;
  gap: 20px;
  margin: 10px;
  font-size: 16px;
}

#board {
  display: grid;
  grid-template-columns: repeat(8, var(--tile-size));
  gap: var(--gap);
  touch-action: none;
}

.tile {
  width: var(--tile-size);
  height: var(--tile-size);
  border-radius: 10px;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

.tile.selected {
  outline: 3px solid #fff;
}

.tile.pop {
  transform: scale(1.4);
  opacity: 0;
}

canvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
}
</style>
</head>

<body>

<div id="hud">
  <div>Zeit: <span id="time">60</span>s</div>
  <div>Score: <span id="score">0</span></div>
  <div>Highscore: <span id="highscore">0</span></div>
</div>

<div id="board"></div>
<canvas id="confetti"></canvas>

<script>
const colors = ["#3fa9f5", "#7ac943", "#fcee21", "#9b59b6", "#e74c3c"];
const board = document.getElementById("board");
const timeEl = document.getElementById("time");
const scoreEl = document.getElementById("score");
const highscoreEl = document.getElementById("highscore");

let grid = [];
let selected = [];
let score = 0;
let time = 60;
let timer;

const highscore = localStorage.getItem("highscore") || 0;
highscoreEl.textContent = highscore;

function createBoard() {
  board.innerHTML = "";
  grid = [];
  for (let i = 0; i < 64; i++) {
    const tile = document.createElement("div");
    const color = colors[Math.floor(Math.random() * colors.length)];
    tile.className = "tile";
    tile.style.background = color;
    tile.dataset.color = color;
    tile.dataset.index = i;
    board.appendChild(tile);
    grid.push(tile);
  }
}

function isNeighbor(a, b) {
  const ax = a % 8, ay = Math.floor(a / 8);
  const bx = b % 8, by = Math.floor(b / 8);
  return Math.abs(ax - bx) <= 1 && Math.abs(ay - by) <= 1;
}

function clearSelection(success) {
  selected.forEach(t => t.classList.remove("selected"));
  if (success) selected.forEach(t => t.classList.add("pop"));
  selected = [];
}

board.addEventListener("pointerdown", e => {
  if (!e.target.classList.contains("tile")) return;
  selected = [e.target];
  e.target.classList.add("selected");
});

board.addEventListener("pointermove", e => {
  const el = document.elementFromPoint(e.clientX, e.clientY);
  if (!el || !el.classList.contains("tile")) return;
  if (selected.includes(el)) return;

  const last = selected[selected.length - 1];
  if (
    el.dataset.color === last.dataset.color &&
    isNeighbor(+el.dataset.index, +last.dataset.index)
  ) {
    selected.push(el);
    el.classList.add("selected");
  }
});

board.addEventListener("pointerup", () => {
  if (selected.length >= 4) {
    score += selected.length * 10;
    time += 5;
    scoreEl.textContent = score;
    popConfetti();
    clearSelection(true);
    setTimeout(createBoard, 300);
  } else {
    clearSelection(false);
  }
});

function startTimer() {
  timer = setInterval(() => {
    time--;
    timeEl.textContent = time;
    if (time <= 0) {
      clearInterval(timer);
      endGame();
    }
  }, 1000);
}

function endGame() {
  if (score > highscore) {
    localStorage.setItem("highscore", score);
    highscoreEl.textContent = score;
  }
  alert("Game Over ðŸŽ®");
}

function popConfetti() {
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  const pieces = Array.from({ length: 80 }, () => ({
    x: innerWidth / 2,
    y: innerHeight / 2,
    r: Math.random() * 6 + 4,
    dx: Math.random() * 6 - 3,
    dy: Math.random() * -6 - 2,
    c: colors[Math.floor(Math.random() * colors.length)]
  }));

  let frames = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      p.x += p.dx;
      p.y += p.dy;
      p.dy += 0.15;
      ctx.fillStyle = p.c;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
    });
    frames++;
    if (frames < 40) requestAnimationFrame(animate);
  }
  animate();
}

createBoard();
startTimer();
</script>

</body>
</html>
