<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tile Connect</title>

<style>
:root {
  --tile: 42px;
  --gap: 6px;
}

body {
  margin: 0;
  background: #121212;
  color: #fff;
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#hud {
  display: flex;
  gap: 20px;
  margin: 10px;
}

#wrapper {
  position: relative;
}

#board {
  display: grid;
  grid-template-columns: repeat(8, var(--tile));
  gap: var(--gap);
}

.tile {
  width: var(--tile);
  height: var(--tile);
  border-radius: 10px;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

.tile.selected {
  outline: 3px solid #fff;
}

.tile.pop {
  transform: scale(0.2);
  opacity: 0;
}

canvas {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
</style>
</head>

<body>

<div id="hud">
  <div>Zeit: <span id="time">60</span>s</div>
  <div>Score: <span id="score">0</span></div>
  <div>Highscore: <span id="high">0</span></div>
</div>

<div id="wrapper">
  <canvas id="line"></canvas>
  <div id="board"></div>
</div>

<script>
const colors = ["#3fa9f5","#7ac943","#fcee21","#9b59b6","#e74c3c"];
const board = document.getElementById("board");
const canvas = document.getElementById("line");
const ctx = canvas.getContext("2d");

let tiles = [];
let selected = [];
let score = 0;
let time = 60;

document.getElementById("high").textContent =
  localStorage.getItem("highscore") || 0;

function resizeCanvas() {
  canvas.width = board.offsetWidth;
  canvas.height = board.offsetHeight;
}
window.addEventListener("resize", resizeCanvas);

function createBoard() {
  board.innerHTML = "";
  tiles = [];
  for (let i = 0; i < 64; i++) {
    const t = document.createElement("div");
    t.className = "tile";
    const c = colors[Math.floor(Math.random()*colors.length)];
    t.style.background = c;
    t.dataset.color = c;
    t.dataset.i = i;
    board.appendChild(t);
    tiles.push(t);
  }
  resizeCanvas();
}

function pos(i) {
  return {
    x: i % 8,
    y: Math.floor(i / 8)
  };
}

function neighbor(a, b) {
  const A = pos(a), B = pos(b);
  return Math.abs(A.x - B.x) <= 1 && Math.abs(A.y - B.y) <= 1;
}

function center(tile) {
  const r = tile.getBoundingClientRect();
  const b = board.getBoundingClientRect();
  return {
    x: r.left - b.left + r.width/2,
    y: r.top - b.top + r.height/2
  };
}

function drawLine() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if (selected.length < 2) return;
  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 6;
  ctx.lineCap = "round";
  ctx.beginPath();
  selected.forEach((t,i)=>{
    const p = center(t);
    if(i===0) ctx.moveTo(p.x,p.y);
    else ctx.lineTo(p.x,p.y);
  });
  ctx.stroke();
}

function clearSelection(pop=false) {
  selected.forEach(t=>{
    t.classList.remove("selected");
    if(pop) t.classList.add("pop");
  });
  selected=[];
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

board.addEventListener("pointerdown", e=>{
  if(!e.target.classList.contains("tile")) return;
  selected=[e.target];
  e.target.classList.add("selected");
});

board.addEventListener("pointermove", e=>{
  const el = document.elementFromPoint(e.clientX,e.clientY);
  if(!el || !el.classList.contains("tile")) return;
  if(selected.includes(el)) return;

  const last = selected[selected.length-1];
  if(el.dataset.color===last.dataset.color &&
     neighbor(+el.dataset.i,+last.dataset.i)) {
    selected.push(el);
    el.classList.add("selected");
    drawLine();
  }
});

board.addEventListener("pointerup", ()=>{
  if(selected.length>=4){
    score += selected.length*10;
    time += 5;
    document.getElementById("score").textContent=score;
    clearSelection(true);
    setTimeout(createBoard,200);
  } else {
    clearSelection(false);
  }
});

setInterval(()=>{
  time--;
  document.getElementById("time").textContent=time;
  if(time<=0){
    const high = localStorage.getItem("highscore")||0;
    if(score>high) localStorage.setItem("highscore",score);
    alert("Game Over ðŸŽ®");
    location.reload();
  }
},1000);

createBoard();
</script>

</body>
</html>
